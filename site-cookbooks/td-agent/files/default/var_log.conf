<source>
  @type tail
  format none
  path /var/log/messages
  tag os.messages
  pos_file /var/log/td-agent/os.messages.pos
</source>

<source>
  @type tail
  format none
  path /var/log/secure
  tag os.secure
  pos_file /var/log/td-agent/os.secure.pos
</source>

<match os.**>
  @type forest
  subtype copy
  <template>
    <store>
      @type bigquery
      method insert

      auth_method json_key
      json_key /etc/td-agent/.keys/nginx-log-to-bigquery-jsonkey.json

      project a-know-home
      dataset centrage_var_log

      flush_interval 1
      buffer_chunk_records_limit 1000
      buffer_queue_limit 1024
      num_threads 16

      auto_create_table true
      table ${tag_parts[1]}_%Y_%m

      time_format %s
      time_field time

      schema_path /etc/td-agent/settings/os.test.schema.json
      field_integer time
    </store>
  </template>
</match>